name: ğŸ“… Daily YouTube Shorts Automation

on:
  schedule:
    - cron: '0 8,12,16,20 * * *'  # 4 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

permissions:
  contents: write

jobs:
  generate-and-upload:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        sudo apt-get update
        sudo apt-get install -y ffmpeg imagemagick
    
    - name: ğŸš€ Generate & Upload Shorts
      env:
        # YouTube Secrets
        YT_CLIENT_ID_1: ${{ secrets.YT_CLIENT_ID_1 }}
        YT_CLIENT_SECRET_1: ${{ secrets.YT_CLIENT_SECRET_1 }}
        YT_REFRESH_TOKEN_1: ${{ secrets.YT_REFRESH_TOKEN_1 }}
        YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
        
        # AI APIs
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        ELEVEN_API_KEY: ${{ secrets.ELEVEN_API_KEY }}
        
        # Media APIs
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        PIXABAY_API_KEY: ${{ secrets.PIXABAY_API_KEY }}
        UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
        
        # Other APIs
        REMOVE_BG_API: ${{ secrets.REMOVE_BG_API }}
      run: |
        python run.py --mode=daily
        
        # Save results
        echo "ğŸ“Š Upload Summary:" >> upload_summary.md
        cat upload_summary.md
        
    - name: ğŸ“ Commit Generated Files
      run: |
        git config --local user.email "github-actions@github.com"
        git config --local user.name "GitHub Actions"
        git add videos/ logs/ upload_summary.md
        git commit -m "ğŸ“… Daily shorts generated & uploaded [skip ci]" || echo "No changes to commit"
        git push origin HEAD:${{ github.ref }}
